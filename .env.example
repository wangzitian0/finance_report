# ==============================================================================
# Backend Configuration
# ==============================================================================
# 
# Note: Variables marked with [VAULT] are managed by Vault in staging/production.
#       Local development uses values from this file or defaults in config.py.

# Database
# Use postgresql+asyncpg:// for async FastAPI compatibility
# [VAULT] Managed by Vault in production/staging
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/finance_report

# App Settings
ENV=development
# [VAULT] Managed by Vault in production/staging (to differentiate environments)
ENVIRONMENT=development
DEBUG=true
BASE_CURRENCY=SGD

# OpenRouter AI Support (Free Models)
# Required for document extraction and AI advisor
# [VAULT] Managed by Vault in production/staging
OPENROUTER_API_KEY=
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
# Default: google/gemini-3-flash-preview (paid, ~$0.0000005/token)
# Alternative free option: google/gemini-2.0-flash-exp:free
PRIMARY_MODEL=google/gemini-3-flash-preview
FALLBACK_MODELS=qwen/qwen-2.5-vl-7b-instruct:free,nvidia/nemotron-nano-12b-v2-vl:free
OPENROUTER_DAILY_LIMIT_USD=2

# S3 / MinIO Storage
# Used for storing uploaded statement files
# [VAULT] All S3_* variables managed by Vault in production/staging
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=minio
S3_SECRET_KEY=<YOUR_S3_SECRET_KEY>
S3_BUCKET=statements
S3_REGION=us-east-1
S3_PRESIGN_EXPIRY_SECONDS=900

# S3 Public Access (for OpenRouter/AI Services)
# REQUIRED in production if S3_ENDPOINT is internal (e.g., http://minio:9000)
# OpenRouter needs publicly accessible URLs to download statement PDFs for parsing
# If not set, the system will send file_content (Base64) when available and only
# fall back to using the S3 file_url when no content is provided. Base64 uploads
# are subject to the backend MAX_UPLOAD_BYTES limit (currently 10MB).
# [VAULT] Managed by Vault in production/staging
S3_PUBLIC_ENDPOINT=https://your-public-s3-endpoint.example.com
S3_PUBLIC_ACCESS_KEY=
S3_PUBLIC_SECRET_KEY=
S3_PUBLIC_BUCKET=

# Observability (SigNoz / OTLP)
# Optional: set in production to ship logs to SigNoz
# [VAULT] Managed by Vault in production/staging
OTEL_EXPORTER_OTLP_ENDPOINT=http://platform-signoz-otel-collector:4318
OTEL_SERVICE_NAME=finance-report-backend
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=development

# Redis (Production/Staging only)
# Moved to Security section

# Security
# [VAULT] CORS_ORIGINS and SECRET_KEY managed by Vault in production/staging
CORS_ORIGINS=http://localhost:3000,http://localhost:3001
CORS_ORIGIN_REGEX=r"https://report(-pr-\d+|-staging)?\.zitian\.party"
# CRITICAL: Must be set to a secure random value in production via Vault
SECRET_KEY=generate_a_secure_token_for_production_here
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
# [VAULT] Managed by Vault in production/staging
# Required for distributed rate limiting
REDIS_URL=redis://localhost:6379/0

# Feature Flags
# EPIC-011: 4-Layer Architecture Migration
# Phase 2: Enable dual write to Layer 1/2 tables (default: false)
# Phase 4: Enable reads from Layer 2 instead of Layer 0 (default: false)
# Phase 5: Enable writes to Layer 0 tables (default: true). Set to false to stop legacy writes.
ENABLE_4_LAYER_WRITE=false
ENABLE_4_LAYER_READ=false
ENABLE_LAYER_0_WRITE=true

# ==============================================================================
# Frontend Configuration
# ==============================================================================

# API URL for frontend requests
# - Development: Leave empty (Next.js rewrites proxy /api to backend)
# - Production: Set to backend URL (e.g., https://report.zitian.party) or leave empty for same-origin
NEXT_PUBLIC_API_URL=

# Frontend app URL for absolute links (redirects, OAuth callbacks, etc.)
# - Development: http://localhost:3000 (default)
# - Production: Set to your public frontend URL (e.g., https://report.zitian.party)
# - PR environments: Auto-set to https://report-pr-101.zitian.party
# Note: Also used by backend if it needs to generate links back to the frontend
# [VAULT] Managed by Vault in production/staging
NEXT_PUBLIC_APP_URL=http://localhost:3000
